# GsonDebuggable
A dull-named utility which helps tracking cause of ClassCastException **at one glance** while using Google's [gson](https://github.com/google/gson). Just copy & paste this code into your project and it will work like a magic.

## Prerequisites and dependencies
Java 1.6+  
[gson](https://github.com/google/gson) 2.3+

## How to use
[Gson is thread-safe](https://google.github.io/gson/apidocs/com/google/gson/Gson.html). Therefore this class utilises singleton pattern.

Applying this project is very simple. Just replace your `Gson` instantiation logic to calling `getInstance()` method on `GsonDebuggable`. For example, change your code like below

	import com.google.gson.Gson;

	Gson gsonInstance = new Gson();

to following:

	import com.github.francescojo.gsondbg.GsonDebuggable;

	GsonDebuggable gsonInstance = GsonDebuggable.getInstance();

and you can utilise GsonDebuggable with minimal code modification cost.

## Usage demo
You will see ClassCastException when running sample code below. Unlike gson, you can see what error has been popped out on which field and what java equivalent type is required in json.

Example code:

	public static void main(String[] args) {
		String json = "{ \"id\": \"{}\", \"name\": \"json\" }";
	
		GsonDebuggable gson = GsonDebuggable.getInstance();
		IdObject idAndName = gson.fromJson(json, IdObject.class);
	
		System.out.println("ID  : " + idAndName.id);
		System.out.println("NAME: " + idAndName.name);
	}

	public static class IdObject {
		@SerializedName("id")
		public int userId;
		public String name;
	}
	
Error message:

	Exception in thread "main" com.google.gson.JsonSyntaxException:
	java.lang.NumberFormatException: 
	Field IdObject#userId expects ''int''; however the JSON was: { "id": "{}" }

## Development background
Google's [gson](https://github.com/google/gson) is great tool, however there is a little inconvenience. As you see, exception log of gson is unfriendly. For example, you can see following exception log if run the sample code in usage demo while using `Gson` rather than `GsonDebuggable`:

	Exception in thread "main" com.google.gson.JsonSyntaxException: 
	java.lang.NumberFormatException:
	For input string: "{}"

Of course we can point the error out in ease because the example is simple. However, what if there are lots of similar fields(fields which can be cast as `Number` in this case)? What if `IdObject` is very complicated? Finally, what if you're developing on some platforms that are logging large-size message is awkward like Android? You probably find out that that exception message generated by gson is insufficient to track down your problem **at one glance**.

So I made this utility to solve this nuisance because I'm too lazy person to beautify and read whole bunch of source json string. This tool will be handy if you're working on large sized JSON api.

## Unit test support
It is quite hard to acquire an mock of `GsonDebuggable` because the only way to acquire its instance is static `getInstance()` method. So, you can inject an `InstanceFactory` before `getInstance()` invocation on test fixtures like below:

	@Before
	public void setUp() {
		GsonDebuggable.setInstanceFactory(() -> {
			return new MockGsonDebuggable();
		});
	}

	@After
	public void tearDown() {
		GsonDebuggable.setInstanceFactory(null);
	}

Of course you can designate your own DI strategy if you don't like the example code above.

## Stripping debuggable logic out on production build
Changing `GsonDebuggable#IS_DEBUG_MODE` to `false` will remove all debugging-related logic by java compiler optimisation in your production binary.

	public abstract class GsonDebuggable {
		private static final boolean IS_DEBUG_MODE = false;
		...
	}
	
If you're working on Android, `BuildConfig.DEBUG` will do same rather than `false`. Actually, relying on BuildConfig.DEBUG is encouraged.

	import your.android.app.BuildConfig;

	public abstract class GsonDebuggable {
		private static final boolean IS_DEBUG_MODE = BuildConfig.DEBUG;
		...
	}

## Licences
This software is distributed under NO LICENCEs.  
You can do whatever you want on this code. Giving me your pull requests and sharing your brilliant idea is always welcome.